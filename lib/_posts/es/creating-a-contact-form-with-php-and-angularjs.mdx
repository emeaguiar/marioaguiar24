---
title: Creando un formulario de contacto con PHP y AngularJS
publishedOn: '2014-08-07'
updatedOn: '2024-10-18T04:06:55.853Z'
description: >-
  AngularJS parece ser la sensaci√≥n en estos d√≠as, por eso decid√≠ intentar y
  aprender lo b√°sico de √©l. De hecho, este mismo sitio web est√° construido
  usando AngularJS, sin embargo, encontr√© un par de problemas mientras trabajaba
  con √©l, nada serio, pero uno de ellos que me sorprendi√≥ fue el formulario de
  contacto, ya que me llev√≥ un tiempo entenderlo, decid√≠ compartir lo que
  aprend√≠ con un peque√±o tutorial.
published: true
readingTime: 660
---
> [!WARNING]
> Este art√≠culo fue escrito en **2014** üë¥üèº. La mayor√≠a de los consejos aqu√≠ no son v√°lidos y
> no recomiendo usar ninguno de los fragmentos mostrados aqu√≠.
>
> Mantengo este art√≠culo aqu√≠ por razones hist√≥ricas y para recordarme cu√°nto he mejorado
> a lo largo de los a√±os.
>
> _Solo se hicieron cambios cosm√©ticos a este art√≠culo._

[AngularJS](http://angularjs.org/) parece ser la sensaci√≥n en estos d√≠as, por eso decid√≠ intentar y aprender lo b√°sico de √©l.
De hecho, este mismo sitio web est√° construido usando AngularJS, sin embargo, encontr√© un par de problemas
mientras trabajaba con √©l, nada serio, pero uno de ellos que me sorprendi√≥ fue el formulario de contacto,
ya que me llev√≥ un tiempo entenderlo, decid√≠ compartir lo que aprend√≠ con un peque√±o tutorial.

## El markup

Para este tutorial voy a usar una configuraci√≥n muy b√°sica, solo un par de campos y
un bot√≥n de env√≠o, as√≠ que empecemos.

```jsx
<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
        <title>Formulario de contacto usando AngularJS :: demo de Mario Aguiar</title>
    </head>
    <body>
       
                            Contactto                                    
                        Nombre:                                            
                   
                        Email:                                            
                   
                        Mensaje:                                            
                   
                        Prometo que no soy un bot                                            
                </fieldset>                 <button type=‚Äùsubmit‚Äù name=‚Äùsubmit‚Äù value=‚Äùsubmit‚Äù>Enviar</button>             </form>         </div>     </body> </html>
```

Muy bien, dir√≠a que es bastante simple, tenemos un formulario, con tres campos de entrada,
**nombre, email y mensaje**, tambi√©n tenemos un cuarto campo usado solo para atrapar bots de spam,
esto estar√° oculto para nuestros visitantes humanos y de hecho necesitamos que est√© vac√≠o,
lo ocultaremos usando css.

### La forma jQuery

Antes de comenzar con AngularJS, veamos c√≥mo har√≠amos esto usando jQuery, como en los buenos viejos tiempos:

```js
(function($) {
  var contactForm = {
    $form: $( 'form' ),
    init: function() {
      this.$form.on( 'submit', this.validateForm );
    },
    validateField: function( $field ) {
      if ( $field.val() === '' ) {
        return false;
      }
      if ( $field.attr( 'type' ) === 'email' ) {
        var emailRegex = /^w+@[a-zA-Z_]+?.[a-zA-Z]{2,3}$/;
        if ( ! emailRegex.test( $field.val() ) ) {
          return false;
        }
      }
      return true;
    },
    validateForm: function(e) {
      e.preventDefault();
      var $form = $(this);
      var fields = $form.find( 'input, textarea' ),
          hasError = false;
      fields.each(function() {
        var $field = $(this);
        if ( $field.attr('required') ) {
          if ( ! contactForm.validateField( $field ) ) {
            console.log('error');
            hasError = true;
          }
        }
      });
      if ( ! hasError ) {
        contactForm.processForm( $form );
      } else {
        contactForm.errorFn();
      }
    },
    processForm: function( $form ) {
      var formData = $form.serialize();
      $.ajax({
        url: 'processForm.php',
        type: 'POST',
        dataType: 'json',
        data: formData + '&submit=' + $form.find('button').val(),
      })
      .done( contactForm.successFn )
      .fail( contactForm.errorFn );
    },
    successFn: function(data) {
      if ( data.success === true ) {
        contactForm.$form.prepend('<p>¬°Gracias por ponerte en contacto!</p>');
      } else {
        contactForm.errorFn();
      }
    },
    errorFn: function() {
      contactForm.$form.prepend('<p>¬°Algo fall√≥!, intenta de nuevo.</p>');
    }
  }
  contactForm.init();
})(jQuery);
```

Despu√©s de configurar un c√≥digo b√°sico, seleccionamos el formulario, agregamos un callback al proceso de env√≠o,
validamos los campos, hacemos la solicitud AJAX y esperamos el resultado, sin embargo, por simple que sea,
**toma unas cuantas l√≠neas de c√≥digo**.

Ahora veamos c√≥mo podr√≠amos lograr lo mismo usando AngularJS.

### La forma AngularJS

En primer lugar, una de las cosas que m√°s me gusta de Angular es **la forma en que se integra con nuestro c√≥digo html**,
¬ønotaste c√≥mo al usar jQuery hicimos casi todo en nuestro archivo js? el c√≥digo html permaneci√≥ pr√°cticamente sin cambios.

AngularJS requiere un poco m√°s de configuraci√≥n en el lado del marcado, as√≠ que cambiemos
a esto:

```jsx
<!DOCTYPE html>
<html ng-app="contact">
    <head>
        <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
        <title>Formulario de contacto usando AngularJS :: demo de Mario Aguiar</title>
    </head>
    <body>
       
                           
¬°Gracias por ponerte en contacto!

¬°Algo fall√≥!, intenta de nuevo.

                            Contacto
                        Nombre:

                        Email:

                        Mensaje:

                        Prometo que no soy un bot
                </fieldset>                 <button type=‚Äùsubmit‚Äù name=‚Äùsubmit‚Äù value=‚Äùsubmit‚Äù>Submit</button>             </form>         </div>          //ajax.googleapis.com/ajax/libs/angularjs/1.2.21/angular.min.js          http://angularForm.js     </body> </html>
```

Unas cuantas directivas aqu√≠ y all√° y nuestro marcado est√° listo para ser integrado con AngularJS,
desglosemos un poco:

- `ng-app="contact"`: Este es el comienzo de nuestra aplicaci√≥n AngularJS, le dice a AngularJS que **todo dentro** de esta etiqueta es parte de la aplicaci√≥n de contacto.
- `ng-controller="contactForm"`: Este es el comienzo de nuestro controlador, los controladores en AngularJS son b√°sicamente funciones que controlan el comportamiento de diferentes caracter√≠sticas en nuestro sitio web.
- `ng-submit="form.$valid && sendMessage(input)"`: Esta etiqueta vincula una funci√≥n a nuestro evento onSubmit, adem√°s, solo se ejecuta cuando el formulario [con nombre] "form" es **v√°lido**.
- `ng-show="success"`: Este atributo lee el valor de "success" enviado por AngularJS y solo muestra la etiqueta si la condici√≥n es v√°lida, en este caso, si "success" o "error" son verdaderos.
- `ng-model`: Esto es lo que AngularJS llama un "enlace bidireccional", significa que todo lo que se escribe en √©l puede ser utilizado por AngularJS, y todo lo que AngularJS env√≠a a √©l se mostrar√° en el campo. ¬øImpresionante no?

Ahora veamos nuestro archivo js:

```js
(function(angular) {
  var app = angular.module("contact", []);
  app.controller("contactForm", ['$scope', '$http', function($scope, $http) {
    $scope.success = false;
    $scope.error = false;
    $scope.sendMessage = function( input ) {
      $http({
          method: 'POST',
          url: '/processForm.php',
          data: input,
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      })
      .success( function(data) {
        if ( data.success ) {
          $scope.success = true;
        } else {
          $scope.error = true;
        }
      } );
    }
  }]);
})(angular);
```

Mucho m√°s peque√±o que nuestro hom√≥logo de jQuery, esto se debe a que no tenemos ninguna
funci√≥n de validaci√≥n en este, ¬øpor qu√©? Simple, porque **AngularJS por defecto
valida el formulario antes de enviarlo**. No solo eso, sino que autom√°ticamente
agrega clases css para campos v√°lidos e inv√°lidos, gracias Angular.

As√≠ que lo √∫nico que necesitamos hacer es hacer la solicitud AJAX usando el componente `$http`,
y estar atentos al resultado, desglosemos:

- `angular.module("contact", []):` Primero definimos nuestro m√≥dulo, o nuestra aplicaci√≥n, y
  todas sus dependencias externas, en este caso no hay ninguna. Tambi√©n almacenar√© esto en la variable app.
- `app.controller("contactForm", ["$scope", "$http", function...`: Luego definimos nuestro controlador
  `contactForm` para manejar nuestro formulario, y sus dependencias, $scope es 
bastante est√°ndar pero no necesario, puedes aprender sobre $scope en [aqu√≠](https://docs.angularjs.org/guide/scope).
`$http` es el m√≥dulo que usaremos para hacer la solicitud AJAX, ya que AngularJS trabaja con **inyecci√≥n de dependencia**, necesitamos hacerle saber que lo necesitamos.
- `$scope.success`: definimos valores predeterminados para nuestros objetos de respuesta, estos podr√≠an
  cambiarse m√°s tarde dependiendo de la respuesta AJAX.
- `$scope.sendMessage( input )`: Esta es la funci√≥n que usaremos para hacer la solicitud AJAX,
  **tomar√° todos los datos de entrada que definimos en nuestro formulario**. Luego har√°
  una solicitud `POST` a `processForm.php` y establecer√° las variables de √©xito o error
  dependiendo de la respuesta.

## El problema

En este punto, nuestro formulario de contacto deber√≠a estar funcionando, pero si intentas enviarlo,
encontrar√°s que **siempre devuelve un error**, ¬øpor qu√© es eso?

AngularJS env√≠a los datos como JSON.

Para ser justos, el problema **no es causado por AngularJS**. El problema realmente es que
**PHP no deserializa este formato**. Pudimos solucionar esto con jQuery
haciendo uso del m√©todo `.serialize()`, pero AngularJS no proporciona un
equivalente para esto, entonces, ¬øqu√© podemos hacer?

## La soluci√≥n

Siempre hay un par de formas de casi todo, y esto no es la excepci√≥n, aqu√≠ te doy dos sugerencias,
puedes elegir la que mejor se adapte a tus necesidades.

### La forma "salvame jQuery"

Podemos usar jQuery para evitar este problema. Aunque AngularJS ya tiene una
versi√≥n reducida de jQuery en √©l, no proporciona el m√©todo que necesitamos,
esto por supuesto significa que **necesitamos incluir jQuery junto con AngularJS**.
Gracias al m√©todo `$.param`.

```js
(function(angular) {
  var app = angular.module("contact", []);
  app.controller("contactForm", ['$scope', '$http', function($scope, $http) {
    $scope.success = false;
    $scope.error = false;
    $scope.sendMessage = function( input ) {
      input.submit = true;
      $http({
          method: 'POST',
          url: 'processForm.php',
          data: angular.element.param(input),
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      })
      .success( function(data) {
        if ( data.success ) {
          $scope.success = true;
        } else {
          $scope.error = true;
        }
      } );
    }
  }]);
})(angular);
```

Dentro de AngularJS, jQuery es conocido como `angular.element`, as√≠ que para usar el
m√©todo que necesitamos, **necesitamos incluir jQuery en nuestro HTML**, y llamarlo usando
`angular.element`. Ahora probamos nuestro formulario nuevamente, ¬°y funciona!

### La forma "arreglalo PHP"

Como dije antes, este es m√°s un problema con PHP, as√≠ que ¬øpor qu√© no dejar que lo arregle?
Es realmente simple, no podemos acceder a nuestras variables `$_POST` de la manera habitual,
pero podemos acceder a ellas usando `file_get_contents`, as√≠ que cambiaremos nuestro PHP a esto:

```php
<?php
    $response = array( 'success' => false );
    $formData = file_get_contents( 'php://input' );
    $data = json_decode( $formData );
    if ( $data->submit && empty( $data->honeypot ) ) {
        $name = $data->name;
        $email = $data->email;
        $message = $data->message;
        if ( $name != '' && $email != '' && $message != '' ) {
            $mailTo = 'example@mydomain.com';
            $subject = 'Nuevo mensaje de contacto';
            $body  = 'De: ' . $name . "n";
            $body .= 'Email: ' . $email . "n";
            $body .= "Mensaje: " . $message . "nn";
            $success = mail( $mailTo, $subject, $body );
            if ( $success ) {
                $response[ 'success' ] = true;
            }
        }
    }
    echo json_encode( $response );
?>
```

Y ah√≠ est√°! Ahora podemos acceder a nuestros datos, y nuestro c√≥digo AngularJS no fue cambiado.

## Conclusi√≥n

Los formularios en AngularJS pueden ser un poco complicados, o tal vez es hora de pasar a
tecnolog√≠as m√°s nuevas, estoy bastante seguro de que este tipo de problema no suceder√≠a si
usara NodeJS en lugar de PHP.
