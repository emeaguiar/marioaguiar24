---
title: 'Transient de WordPress: ¬øQu√© son y c√≥mo se comen?'
publishedOn: '2011-07-22T18:50:36.516Z'
updatedOn: '2024-07-20T23:23:17.685Z'
description: >-
  A pesar de ser mi herramienta de trabajo diario favorita y la que m√°s conozco,
  WordPress todav√≠a tiene varias opciones y funciones que nunca he usado. Hace
  no mucho tiempo, una de ellas fue la API de Transients. Funciones realmente 
  √∫tiles para almacenar datos temporales en la base de datos.
published: true
readingTime: 480
---

import Code from '@/components/code/code';

> [!WARNING]
> Este art√≠culo fue escrito en **2011** üë¥üèº. La mayor√≠a de los consejos aqu√≠ pueden no ser v√°lidos.
>
> Mantengo este art√≠culo aqu√≠ por razones hist√≥ricas y para recordarme cu√°nto he mejorado
> a lo largo de los a√±os.
>
> _Solo se hicieron cambios cosm√©ticos a este art√≠culo._

A pesar de ser mi herramienta de trabajo diario favorita y la que m√°s conozco,
WordPress todav√≠a tiene varias opciones y funciones que nunca he usado. Hace no mucho tiempo,
una de ellas fue la [API de Transientes](https://marioaguiar.net/web/20120430100255/http://codex.wordpress.org/Transients_API).
Funciones realmente √∫tiles para **almacenar datos temporales en la base de datos**.

## ¬øQu√© son los Transientes?

En el lenguaje de WordPress, un transient es cualquier pieza de datos temporal, lo que significa que
**esperamos que se elimine**. Esto es √∫til si tenemos informaci√≥n que vamos a usar
por un corto per√≠odo de tiempo y no queremos llenar la base de datos.

Digamos que tenemos un formulario de contacto (o comentarios) donde el usuario escribir√° el nombre,
correo electr√≥nico, sitio web y comentario, una vez que los escriba, se env√≠a el formulario,
5 minutos despu√©s el usuario encuentra un error en nuestro sitio y quiere ponerse en contacto de nuevo,
¬øtiene que volver a llenar TODOS los campos? Por lo general, s√≠, pero usando **Transients** 
podemos ahorrarle la molestia.

## El C√≥digo

La API de Transientes y la API de Opciones son bastante similares, y tambi√©n muy f√°ciles de usar,
de hecho, est√° conformada por solo tres funciones:

- `set_transient( $transient, $value, $expiration)`: La funci√≥n que crea nuestro transient, donde:
- `$transient` es el **nombre √∫nico** del transient, esto es importante ya que es
la clave para encontrar el transient m√°s tarde.
- `$value` es el contenido del transient, puede ser una cadena o un array.
- `$expiration` es la parte importante aqu√≠, es el tiempo (en segundos) que nuestros datos
permanecer√°n en nuestra base de datos, una vez que se acabe el tiempo, el transient se eliminar√°.
- `get_transient( $transient )`: La funci√≥n que usamos para llamar a nuestro transient, donde
`$transient` es el **nombre √∫nico** que establecimos antes.
- `delete_transient( $transient )`: Aunque los transientes se eliminan autom√°ticamente
cuando se acaban el tiempo, puede ser el caso de que queramos eliminarlos manualmente,
donde $transient sigue siendo el **nombre √∫nico** del que hablo tanto.

## ¬øC√≥mo se usan?

Siguiendo la situaci√≥n anterior (el formulario de contacto), mostrar√© un peque√±o ejemplo
del uso de transientes, nada de qu√© preocuparse, comenzamos con el formulario:

<Code
    language="php"
    children={`<form id="transient_test" action="process.php" method="post">
    <fieldset>
        <label for="name">Nombre:</label>
        <input id="name" type="text" name="name" />
        <label for="email">Correo electr√≥nico:</label>
        <input id="email" type="email" name="email" />
        <label for="url">URL:</label>
        <input id="url" type="url" name="url" />
        <label for="comment">Comentario:</label>
        <textarea id="comment" name="comment"></textarea>
        <input id="submit" type="submit" name="submit" value="enviado" />
    </fieldset>
</form>`}
/>

Esto nos dar√° un formulario bastante simple, tomamos **Nombre**, **Correo electr√≥nico**, 
**URL** y **Comentario**. Tambi√©n note que estoy usando atributos HTML5, no se preocupen,
no soy un hipster.

Una vez que tenemos los datos, por supuesto debemos procesarlos, para hacer eso necesitaremos
un archivo php que he llamado `process.php`, este funcionar√° m√°s o menos as√≠.

<Code
    language="php"
    children={`<?php 
    if ( isset( $_POST['submit'] ) ) { // Aseg√∫rate de que el formulario fue enviado
        $name = $_POST['name'];
        $email = $_POST['email'];
        $url = $_POST['url'];
        $comment = $_POST['comment'];
        $time = 60*60*24; // Expira en 1 d√≠a *
        $this_transient = get_transient($name . '_' . $email); // Busca alg√∫n transient
        if (!$this_transient ) { // Si no existe
            set_transient('name_' . $email, $name, $time);
            set_transient('mail_' . $email, $email, $time);
            set_transient('url_' . $email, $url, $time);
        }
        $message = "Nombre: " . $name . "nnCorreo electr√≥nico: " . $email . "nnURL: " . $url;
        $headers = 'De: ' . $name;
        wp_mail("me@me.com", "Prueba de Transientes", $comment, $headers); // Enviar un correo
    }
?>`}
/>

Ok, ahora este c√≥digo tomar√° los datos que enviamos a trav√©s del formulario y buscar√° la
base de datos para el valor clave (nuestro correo), si no existe, crear√° nuevos
transientes con nombres como **name_me@me.com** usando los datos, estos expirar√°n en
24 horas. Despu√©s de eso enviar√° un correo con el comentario.

> [!NOTE]
> `$time` debe ser un valor de tiempo en segundos, como no tengo idea de cu√°ntos segundos
> hay en un d√≠a** es m√°s f√°cil dejar que PHP haga el c√°lculo, esto es **60 segundos
> √ó 60 minutos √ó 24 horas**, a√∫n m√°s f√°cil: **60‚Ä≥ √ó 60‚Ä≤ = 1 hora √ó 24 = 24 horas**.

Bien, tenemos el c√≥digo para almacenar los transientes, ¬øy ahora qu√©? Correcto, los necesit√°bamos
para que el usuario no tenga que escribirlos una y otra vez en el formulario, para
hacer eso tenemos que modificar nuestro formulario y agregar una `cookie`:

<Code
    language="php"
    children={`$cookie = $_COOKIE['transients_test'];
<form id="transient_test" action="process.php" method="post">
    <fieldset>
        <label for="name">Nombre:</label>
        <input id="name" type="text" name="name" value="<?php echo get_transient('name_'.$cookie); ?>" />
        <label for="email">Correo electr√≥nico:</label>
        <input id="email" type="email" name="email" value="<?php echo get_transient('name_'.$cookie); ?>" />
        <label for="url">URL:</label>
        <input id="url" type="url" name="url" value="<?php echo get_transient('name_'.$cookie); ?>" />
        <label for="comment">Comentario:</label>
        <textarea id="comment" name="comment"></textarea>
        <input id="submit" type="submit" name="submit" value="enviado" />
    </fieldset>
</form>`}
/>

Ahora el formulario comprobar√° la existencia de la cookie llamada transients_test, que
no existe en este momento, para crearla tenemos que agregar lo siguiente al archivo `process.php`:

<Code
    language="php"
    children={`setcookie('transients_test', $_POST['email'], time()+86400, '/', $_SERVER['HTTP_HOST'], 0, 0 );
`}
/>

Eso crear√° la cookie llamada `transients_test`, con el correo del usuario, expirar√° en
**86400 segundos** (total de segundos en un d√≠a) y ser√° v√°lida para todo nuestro sitio.

Eso es todo, tenemos nuestro formulario de contacto que recuerda a nuestros visitantes por un d√≠a completo,
despu√©s de eso sus datos se borrar√°n de nuestra base de datos hasta la pr√≥xima vez que
llenen y env√≠en el formulario.

## Notas

Por lo general, los transientes se almacenan en nuestra tabla de base de datos wp_options, pero
pueden no estar, algunos plugins pueden cambiar su ubicaci√≥n, por eso se recomienda usar
transientes **solo con datos que se espera que se borren**. Si quieres mantenerlo, usa otro m√©todo.

## Leer m√°s

- [Transients API ¬´ WordPress Codex](https://marioaguiar.net/web/20120430100255/http://codex.wordpress.org/Transients_API)
